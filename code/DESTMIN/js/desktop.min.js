jQuery.noConflict();
(function(n,y,I){function F(c,m){for(const h in c){if(h===m)return c[h];if("object"===typeof c[h]){const q=F(c[h],m);if(void 0!==q)return q}}}function J(c,m){for(const h in c.table.fieldList)if(c.table.fieldList[h].var===m)return c.table.fieldList[h];for(const h in c.subTable)for(const q in c.subTable[h].fieldList)if(c.subTable[h].fieldList[q].var===m)return c.subTable[h].fieldList[q];return null}function G(c,m){for(const h in c){const q=c[h];if("SUBTABLE"===q.type)for(const t of q.value)if(t.value.hasOwnProperty(m))return h}return!1}const B=
kintone.plugin.app.getConfig(I),D=JSON.parse(B.translate_fields),z=JSON.parse(B.language_list);if(B&&z&&D){var u=B.default_language||z[0].iso;kintone.events.on("app.record.detail.show",function(){try{window.BoK.eAutoTrans.showLang(u)}catch(c){return y.fire({icon:"error",title:"",html:c.message||c})}});kintone.events.on(["app.record.edit.show","app.record.create.show"],async function(c){try{const m=c.record,h=cybozu.data.page.SCHEMA_DATA,q=B.translate_direction;window.BoK.eAutoTrans.showLang(u);for await(let b of D)if(!b.space_element)for(let a=
0;a<b.target_fields.length;a++){let g=b.target_fields[a],d=J(h,g.field);if(null==d||!g.field)continue;let r=`.field-${d.id}`;if(g.iso.toUpperCase()===u.toUpperCase())n(document).on("mouseover",r,async function(p){let x=setTimeout(async()=>{p.preventDefault();const k=n("#custom-context-menu");k.length&&k.remove();var e=n("<div>").attr("id","custom-context-menu").css({position:"absolute",background:"#fff",border:"1px solid #ccc",boxShadow:"2px 2px 5px rgba(0, 0, 0, 0.1)",padding:"5px",left:p.pageX+
"px",top:p.pageY+"px"});n.each(b.target_fields,function(f,l){if(l.iso.toUpperCase()!==u.toUpperCase()&&""!==l.field){let C=l.field,E=d.var;f=z.filter(v=>v.iso.toUpperCase()===l.iso.toUpperCase())[0].button_label;f=new Kuc.Button({text:f,type:"normal",id:C});e.append(f);n(f).on("click",async()=>{try{const v=l.iso;let w=F(m,E).type,K=G(m,d.var),L=n(p.target).closest("tr").index();e.remove();await H(w,v,u,K,E,C,L);y.fire({position:"center-center",icon:"success",text:"\u7ffb\u8a33\u5b8c\u4e86\u3057\u307e\u3057\u305f",
showConfirmButton:!1,timer:1E3})}catch(v){return y.fire({icon:"error",title:"",html:v.message||v||"\u9805\u76ee\u30b3\u30fc\u30c9\u304c\u5b58\u5728\u3057\u307e\u305b\u3093"})}})}});n("body").append(e);n(document).on("click",function(f){e.is(f.currentTarget)||0!==e.has(f.currentTarget).length||e.remove()});e.on("mouseleave",function(){e.remove()})},400);n(this).on("mouseout",function(){clearTimeout(x)})})}let t={},A={};n.each(D,function(b,a){if(a.space_element)if(t[a.space_element]){b=t[a.space_element][0];
for(let g=0;g<a.target_fields.length;g++)a.target_fields[g].field&&!b.target_fields[g].field&&(A[a.space_element][g]=""!=a.target_fields[g].field)}else{t[a.space_element]||(t[a.space_element]=[]);t[a.space_element].push(a);if(!A[a.space_element])for(A[a.space_element]=[],b=0;b<a.target_fields.length;b++)A[a.space_element].push(!1);for(b=0;b<a.target_fields.length;b++)A[a.space_element][b]=""!=a.target_fields[b].field}});n.each(t,function(b,a){let g=kintone.app.record.getSpaceElement(b);n.each(z,function(d,
r){let p=z[d].button_label;!1!==A[b][d]&&r.iso.toUpperCase()!==u.toUpperCase()&&(d=new Kuc.Button({text:p,type:"normal"}),g.append(d),n(d).on("click",async function(x){const k=D.filter(e=>e.space_element===b);for(let e=0;e<k.length;e++)try{const f=z.filter(w=>w.button_label===x.target.text)[0].iso;let l=k[e].target_fields.filter(w=>w.iso.toUpperCase()===u.toUpperCase())[0].field,C=k[e].target_fields.filter(w=>w.iso.toUpperCase()===f.toUpperCase())[0].field;if(!l||!C)continue;let E=F(m,l).type,v=G(m,
l);await H(E,f,u,v,l,C,-1);y.fire({position:"center-center",icon:"success",text:"\u7ffb\u8a33\u5b8c\u4e86\u3057\u307e\u3057\u305f",showConfirmButton:!1,timer:1E3})}catch(f){return y.fire({icon:"error",title:"",html:f.message||f||"\u9805\u76ee\u30b3\u30fc\u30c9\u304c\u5b58\u5728\u3057\u307e\u305b\u3093"})}}))})});async function H(b,a,g,d,r,p,x){let k=kintone.app.record.get();if(!1!==d){let e=k.record[d].value;for(let f=0;f<e.length;f++){let l=0>x?f:x;switch(q){case "from":r&&(d=await window.BoK.eAutoTrans.transText(g,
e[l].value[p].value||"",a,b),kintone.app.record.set(c,e[l].value[r].value=d),e[l].value[r].value=d,kintone.app.record.set(k));break;case "to":p&&(d=await window.BoK.eAutoTrans.transText(a,e[l].value[r].value||"",g,b),e[l].value[p].value=d,kintone.app.record.set(k))}if(-1<x)break}}else switch(q){case "from":r&&(d=await window.BoK.eAutoTrans.transText(g,k.record[p].value||"",a,b),k.record[r].value=d,kintone.app.record.set(k));break;case "to":p&&(d=await window.BoK.eAutoTrans.transText(a,k.record[r].value||
"",g,b),k.record[p].value=d,kintone.app.record.set(k))}}return c}catch(m){return y.fire({icon:"error",title:"",html:m.message||m})}})}})(jQuery,Sweetalert2_10.noConflict(!0),kintone.$PLUGIN_ID);
