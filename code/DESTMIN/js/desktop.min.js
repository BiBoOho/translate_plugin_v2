jQuery.noConflict();
(function(n,y,K){function F(c,k){for(const f in c){if(f===k)return c[f];if("object"===typeof c[f]){const q=F(c[f],k);if(void 0!==q)return q}}}function G(c,k){for(const f in c.table.fieldList)if(c.table.fieldList[f].var===k)return c.table.fieldList[f];for(const f in c.subTable)for(const q in c.subTable[f].fieldList)if(c.subTable[f].fieldList[q].var===k)return c.subTable[f].fieldList[q];console.log("data:",c);console.log("fieldCode:",k);return null}function I(c,k){for(const f in c){const q=c[f];if("SUBTABLE"===
q.type)for(const t of q.value)if(t.value.hasOwnProperty(k))return f}return!1}const C=kintone.plugin.app.getConfig(K),D=JSON.parse(C.translate_fields),z=JSON.parse(C.language_list);if(C&&z&&D){var u=C.default_language||z[0].iso;kintone.events.on("app.record.detail.show",function(){try{window.BoK.eAutoTrans.showLang(u)}catch(c){return y.fire({icon:"error",title:"",html:c.message||c})}});kintone.events.on(["app.record.edit.show","app.record.create.show"],async function(c){try{const k=c.record,f=cybozu.data.page.SCHEMA_DATA,
q=C.translate_direction;window.BoK.eAutoTrans.showLang(u);for await(let b of D)if(!b.space_element)for(let a=0;a<b.target_fields.length;a++){let g=b.target_fields[a];if(!g.field||""==g.field)continue;let d=G(f,g.field);if(null==d)continue;let r=`.field-${d.id}`;if(g.iso.toUpperCase()===u.toUpperCase())n(document).on("mouseover",r,async function(p){let x=setTimeout(async()=>{p.preventDefault();const l=n("#custom-context-menu");l.length&&l.remove();var e=n("<div>").attr("id","custom-context-menu").css({position:"absolute",
background:"#fff",border:"1px solid #ccc",boxShadow:"2px 2px 5px rgba(0, 0, 0, 0.1)",padding:"5px",left:p.pageX+"px",top:p.pageY+"px"});n.each(b.target_fields,function(h,m){if(m.iso.toUpperCase()!==u.toUpperCase()&&""!==m.field){let A=m.field,E=d.var;h=z.filter(v=>v.iso.toUpperCase()===m.iso.toUpperCase())[0].button_label;h=new Kuc.Button({text:h,type:"normal",id:A});e.append(h);n(h).on("click",async()=>{try{const v=m.iso;let H=F(k,E).type,w=I(k,d.var),L=n(p.target).closest("tr").index();e.remove();
await J(H,v,u,w,E,A,L)}catch(v){y.fire({icon:"error",title:"",html:v.message||v});return}y.fire({position:"center-center",icon:"success",text:"\u7ffb\u8a33\u5b8c\u4e86\u3057\u307e\u3057\u305f",showConfirmButton:!1,timer:1E3})})}});n("body").append(e);n(document).on("click",function(h){e.is(h.currentTarget)||0!==e.has(h.currentTarget).length||e.remove()});e.on("mouseleave",function(){e.remove()})},400);n(this).on("mouseout",function(){clearTimeout(x)})})}let t={},B={};n.each(D,function(b,a){if(a.space_element)if(t[a.space_element]){b=
t[a.space_element][0];for(let g=0;g<a.target_fields.length;g++)a.target_fields[g].field&&!b.target_fields[g].field&&(B[a.space_element][g]=""!=a.target_fields[g].field)}else{t[a.space_element]||(t[a.space_element]=[]);t[a.space_element].push(a);if(!B[a.space_element])for(B[a.space_element]=[],b=0;b<a.target_fields.length;b++)B[a.space_element].push(!1);for(b=0;b<a.target_fields.length;b++)B[a.space_element][b]=""!=a.target_fields[b].field}});n.each(t,function(b,a){let g=kintone.app.record.getSpaceElement(b);
n.each(z,function(d,r){let p=z[d].button_label;!1!==B[b][d]&&r.iso.toUpperCase()!==u.toUpperCase()&&(d=new Kuc.Button({text:p,type:"normal"}),g.append(d),n(d).on("click",async function(x){const l=D.filter(e=>e.space_element===b);for(let e=0;e<l.length;e++)try{const h=z.filter(w=>w.button_label===x.target.text)[0].iso;let m=l[e].target_fields.filter(w=>w.iso.toUpperCase()===u.toUpperCase())[0].field,A=l[e].target_fields.filter(w=>w.iso.toUpperCase()===h.toUpperCase())[0].field;if(!m||!A)continue;let E=
G(f,m);if(null==G(f,A)||null==E)continue;let v=F(k,m).type,H=I(k,m);await J(v,h,u,H,m,A,-1)}catch(h){return y.fire({icon:"error",title:"",html:h.message||h})}y.fire({position:"center-center",icon:"success",text:"\u7ffb\u8a33\u5b8c\u4e86\u3057\u307e\u3057\u305f",showConfirmButton:!1,timer:1E3})}))})});async function J(b,a,g,d,r,p,x){let l=kintone.app.record.get();if(!1!==d){let e=l.record[d].value;for(let h=0;h<e.length;h++){let m=0>x?h:x;switch(q){case "from":r&&(d=await window.BoK.eAutoTrans.transText(g,
e[m].value[p].value||"",a,b),e[m].value[r].value=d,kintone.app.record.set(l));break;case "to":p&&(d=await window.BoK.eAutoTrans.transText(a,e[m].value[r].value||"",g,b),e[m].value[p].value=d,kintone.app.record.set(l))}if(-1<x)break}}else switch(q){case "from":r&&(d=await window.BoK.eAutoTrans.transText(g,l.record[p].value||"",a,b),l.record[r].value=d,kintone.app.record.set(l));break;case "to":p&&(d=await window.BoK.eAutoTrans.transText(a,l.record[r].value||"",g,b),l.record[p].value=d,kintone.app.record.set(l))}}
return c}catch(k){return y.fire({icon:"error",title:"",html:k.message||k})}})}})(jQuery,Sweetalert2_10.noConflict(!0),kintone.$PLUGIN_ID);
