jQuery.noConflict();
(function(n,E,I){function F(c,m){for(const h in c){if(h===m)return c[h];if("object"===typeof c[h]){const q=F(c[h],m);if(void 0!==q)return q}}}function J(c,m){for(const h in c.table.fieldList)if(c.table.fieldList[h].var===m)return c.table.fieldList[h];for(const h in c.subTable)for(const q in c.subTable[h].fieldList)if(c.subTable[h].fieldList[q].var===m)return c.subTable[h].fieldList[q];return null}function G(c,m){for(const h in c){const q=c[h];if("SUBTABLE"===q.type)for(const t of q.value)if(t.value.hasOwnProperty(m))return h}return!1}const z=
kintone.plugin.app.getConfig(I),C=JSON.parse(z.translate_fields),x=JSON.parse(z.language_list);if(z&&x&&C){var u=z.default_language||x[0].iso;kintone.events.on("app.record.detail.show",function(){try{window.BoK.eAutoTrans.showLang(u)}catch(c){return E.fire({icon:"error",title:"Error",html:c.message||c})}});kintone.events.on(["app.record.edit.show","app.record.create.show"],async function(c){try{const m=c.record,h=cybozu.data.page.SCHEMA_DATA,q=z.translate_direction;window.BoK.eAutoTrans.showLang(u);
for await(let b of C)if(!b.space_element)for(let a=0;a<b.target_fields.length;a++){let g=b.target_fields[a],d=J(h,g.field);if(null==d||!g.field)continue;let r=`.field-${d.id}`;if(g.iso.toUpperCase()===u.toUpperCase())n(document).on("mouseover",r,async function(p){let w=setTimeout(async()=>{p.preventDefault();const k=n("#custom-context-menu");k.length&&k.remove();var e=n("<div>").attr("id","custom-context-menu").css({position:"absolute",background:"#fff",border:"1px solid #ccc",boxShadow:"2px 2px 5px rgba(0, 0, 0, 0.1)",
padding:"5px",left:p.pageX+"px",top:p.pageY+"px"});n.each(b.target_fields,function(f,l){if(l.iso.toUpperCase()!==u.toUpperCase()&&""!==l.field){let A=l.field,D=d.var;f=x.filter(B=>B.iso.toUpperCase()===l.iso.toUpperCase())[0].button_label;f=new Kuc.Button({text:f,type:"normal",id:A});e.append(f);n(f).on("click",async()=>{const B=l.iso;let v=F(m,D).type,K=G(m,d.var),L=n(p.target).closest("tr").index();e.remove();await H(v,B,u,K,D,A,L)})}});n("body").append(e);n(document).on("click",function(f){e.is(f.currentTarget)||
0!==e.has(f.currentTarget).length||e.remove()});e.on("mouseleave",function(){e.remove()})},400);n(this).on("mouseout",function(){clearTimeout(w)})})}let t={},y={};n.each(C,function(b,a){if(a.space_element)if(t[a.space_element]){b=t[a.space_element][0];for(let g=0;g<a.target_fields.length;g++)a.target_fields[g].field&&!b.target_fields[g].field&&(y[a.space_element][g]=""!=a.target_fields[g].field)}else{t[a.space_element]||(t[a.space_element]=[]);t[a.space_element].push(a);if(!y[a.space_element])for(y[a.space_element]=
[],b=0;b<a.target_fields.length;b++)y[a.space_element].push(!1);for(b=0;b<a.target_fields.length;b++)y[a.space_element][b]=""!=a.target_fields[b].field}});n.each(t,function(b,a){let g=kintone.app.record.getSpaceElement(b);n.each(x,function(d,r){let p=x[d].button_label;!1!==y[b][d]&&r.iso.toUpperCase()!==u.toUpperCase()&&(d=new Kuc.Button({text:p,type:"normal"}),g.append(d),n(d).on("click",async function(w){const k=C.filter(e=>e.space_element===b);for(let e=0;e<k.length;e++)try{const f=x.filter(v=>
v.button_label===w.target.text)[0].iso;let l=k[e].target_fields.filter(v=>v.iso.toUpperCase()===u.toUpperCase())[0].field,A=k[e].target_fields.filter(v=>v.iso.toUpperCase()===f.toUpperCase())[0].field;if(!l||!A)continue;let D=F(m,l).type,B=G(m,l);await H(D,f,u,B,l,A,-1)}catch(f){return E.fire({icon:"error",title:"Error",html:f.message||f})}}))})});async function H(b,a,g,d,r,p,w){let k=kintone.app.record.get();if(!1!==d){let e=k.record[d].value;for(let f=0;f<e.length;f++){let l=0>w?f:w;switch(q){case "from":r&&
(d=await window.BoK.eAutoTrans.transText(g,e[l].value[p].value||"",a,b),kintone.app.record.set(c,e[l].value[r].value=d),e[l].value[r].value=d,kintone.app.record.set(k));break;case "to":p&&(d=await window.BoK.eAutoTrans.transText(a,e[l].value[r].value||"",g,b),e[l].value[p].value=d,kintone.app.record.set(k))}if(-1<w)break}}else switch(q){case "from":r&&(d=await window.BoK.eAutoTrans.transText(g,k.record[p].value||"",a,b),k.record[r].value=d,kintone.app.record.set(k));break;case "to":p&&(d=await window.BoK.eAutoTrans.transText(a,
k.record[r].value||"",g,b),k.record[p].value=d,kintone.app.record.set(k))}}return c}catch(m){return E.fire({icon:"error",title:"Error",html:m.message||m})}})}})(jQuery,Sweetalert2_10.noConflict(!0),kintone.$PLUGIN_ID);
