jQuery.noConflict();
(function(n,t,M){function G(d,l){for(const g in d){if(g===l)return d[g];if("object"===typeof d[g]){const q=G(d[g],l);if(void 0!==q)return q}}}function H(d,l){for(const g in d.table.fieldList)if(d.table.fieldList[g].var===l)return d.table.fieldList[g];for(const g in d.subTable)for(const q in d.subTable[g].fieldList)if(d.subTable[g].fieldList[q].var===l)return d.subTable[g].fieldList[q];return null}function J(d,l){for(const g in d){const q=d[g];if("SUBTABLE"===q.type)for(const u of q.value)if(u.value.hasOwnProperty(l))return g}return!1}const C=
kintone.plugin.app.getConfig(M),D=JSON.parse(C.translate_fields),z=JSON.parse(C.language_list);if(C&&z&&D){var v=C.default_language||z[0].iso;kintone.events.on("app.record.detail.show",function(){try{window.BoK.eAutoTrans.showLang(v)}catch(d){return t.fire({icon:"error",title:"",html:d.message||d})}});kintone.events.on(["app.record.edit.show","app.record.create.show"],async function(d){try{const l=d.record,g=cybozu.data.page.SCHEMA_DATA,q=C.translate_direction;window.BoK.eAutoTrans.showLang(v);for await(let c of D)if(!c.space_element)for(let b=
0;b<c.target_fields.length;b++){let h=c.target_fields[b];if(!h.field||""==h.field)continue;let a=H(g,h.field);if(null==a)continue;let r=`.field-${a.id}`;if(h.iso.toUpperCase()===v.toUpperCase())n(document).on("mouseover",r,async function(p){let y=setTimeout(async()=>{p.preventDefault();const f=n("#custom-context-menu");f.length&&f.remove();var e=n("<div>").attr("id","custom-context-menu").css({position:"absolute",background:"#fff",border:"1px solid #ccc",boxShadow:"2px 2px 5px rgba(0, 0, 0, 0.1)",
padding:"5px",left:p.pageX+"px",top:p.pageY+"px"});n.each(c.target_fields,function(m,k){if(k.iso.toUpperCase()!==v.toUpperCase()&&""!==k.field){let A=k.field,E=a.var;m=z.filter(w=>w.iso.toUpperCase()===k.iso.toUpperCase())[0].button_label;m=new Kuc.Button({text:m,type:"normal",id:A});e.append(m);n(m).on("click",async()=>{try{const w=k.iso;let I=G(l,E).type,F=J(l,a.var),x=n(p.target).closest("tr").index();e.remove();let L=await K(I,w,v,F,E,A,x);if("object"===typeof L)return t.fire({icon:"error",title:"",
html:L.msg});t.fire({position:"center-center",icon:"success",text:"\u7ffb\u8a33\u5b8c\u4e86\u3057\u307e\u3057\u305f",showConfirmButton:!1,timer:1E3})}catch(w){t.fire({icon:"error",title:"",html:w.message||w})}})}});n("body").append(e);n(document).on("click",function(m){e.is(m.currentTarget)||0!==e.has(m.currentTarget).length||e.remove()});e.on("mouseleave",function(){e.remove()})},400);n(this).on("mouseout",function(){clearTimeout(y)})})}let u={},B={};n.each(D,function(c,b){if(b.space_element)if(u[b.space_element]){c=
u[b.space_element][0];for(let h=0;h<b.target_fields.length;h++)b.target_fields[h].field&&!c.target_fields[h].field&&(B[b.space_element][h]=""!=b.target_fields[h].field)}else{u[b.space_element]||(u[b.space_element]=[]);u[b.space_element].push(b);if(!B[b.space_element])for(B[b.space_element]=[],c=0;c<b.target_fields.length;c++)B[b.space_element].push(!1);for(c=0;c<b.target_fields.length;c++)B[b.space_element][c]=""!=b.target_fields[c].field}});n.each(u,function(c,b){let h=kintone.app.record.getSpaceElement(c);
n.each(z,function(a,r){let p=z[a].button_label;!1!==B[c][a]&&r.iso.toUpperCase()!==v.toUpperCase()&&(a=new Kuc.Button({text:p,type:"normal"}),h.append(a),n(a).on("click",async function(y){try{const f=D.filter(e=>e.space_element===c);for(let e=0;e<f.length;e++){const m=z.filter(x=>x.button_label===y.target.text)[0].iso;let k=f[e].target_fields.filter(x=>x.iso.toUpperCase()===v.toUpperCase())[0].field,A=f[e].target_fields.filter(x=>x.iso.toUpperCase()===m.toUpperCase())[0].field;if(!k||!A)continue;
let E=H(g,k);if(null==H(g,A)||null==E)continue;let w=G(l,k).type,I=J(l,k),F=await K(w,m,v,I,k,A,-1);if("object"===typeof F)return t.fire({icon:"error",title:"",html:F.msg})}t.fire({position:"center-center",icon:"success",text:"\u7ffb\u8a33\u5b8c\u4e86\u3057\u307e\u3057\u305f",showConfirmButton:!1,timer:1E3})}catch(f){return t.fire({icon:"error",title:"",html:f.message||f})}}))})});async function K(c,b,h,a,r,p,y){let f=kintone.app.record.get();if(!1!==a){let e=f.record[a].value;for(let m=0;m<e.length;m++){let k=
0>y?m:y;switch(q){case "from":if(r){a=await window.BoK.eAutoTrans.transText(h,e[k].value[p].value||"",b,c);if("object"===typeof a)return a;e[k].value[r].value=a;kintone.app.record.set(f)}break;case "to":if(p){a=await window.BoK.eAutoTrans.transText(b,e[k].value[r].value||"",h,c);if("object"===typeof a)return a;e[k].value[p].value=a;kintone.app.record.set(f)}}if(-1<y)break}}else switch(q){case "from":if(r){a=await window.BoK.eAutoTrans.transText(h,f.record[p].value||"",b,c);if("object"===typeof a)return a;
f.record[r].value=a;kintone.app.record.set(f)}break;case "to":if(p){a=await window.BoK.eAutoTrans.transText(b,f.record[r].value||"",h,c);if("object"===typeof a)return a;f.record[p].value=a;kintone.app.record.set(f)}}}return d}catch(l){return t.fire({icon:"error",title:"",html:l.message||l})}})}})(jQuery,Sweetalert2_10.noConflict(!0),kintone.$PLUGIN_ID);
