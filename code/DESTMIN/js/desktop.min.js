jQuery.noConflict();
(function(p,z,J){function F(c,m){for(const h in c){if(h===m)return c[h];if("object"===typeof c[h]){const r=F(c[h],m);if(void 0!==r)return r}}}function K(c,m){for(const h in c.table.fieldList)if(c.table.fieldList[h].var===m)return c.table.fieldList[h];for(const h in c.subTable)for(const r in c.subTable[h].fieldList)if(c.subTable[h].fieldList[r].var===m)return c.subTable[h].fieldList[r];return null}function H(c,m){for(const h in c){const r=c[h];if("SUBTABLE"===r.type)for(const u of r.value)if(u.value.hasOwnProperty(m))return h}return!1}const C=
kintone.plugin.app.getConfig(J),E=JSON.parse(C.translate_fields),A=JSON.parse(C.language_list);if(C&&A&&E){var v=C.default_language||A[0].iso;kintone.events.on("app.record.detail.show",function(){try{window.BoK.eAutoTrans.showLang(v)}catch(c){return z.fire({icon:"error",title:"",html:c.message||c})}});kintone.events.on(["app.record.edit.show","app.record.create.show"],async function(c){try{const m=c.record,h=cybozu.data.page.SCHEMA_DATA,r=C.translate_direction;window.BoK.eAutoTrans.showLang(v);for await(let b of E)if(!b.space_element)for(let a=
0;a<b.target_fields.length;a++){let g=b.target_fields[a],d=K(h,g.field);if(null==d||!g.field)continue;let q=`.field-${d.id}`;if(g.iso.toUpperCase()===v.toUpperCase())p(document).on("mouseover",q,async function(n){let y=setTimeout(async()=>{n.preventDefault();const k=p("#custom-context-menu");k.length&&k.remove();var e=p("<div>").attr("id","custom-context-menu").css({position:"absolute",background:"#fff",border:"1px solid #ccc",boxShadow:"2px 2px 5px rgba(0, 0, 0, 0.1)",padding:"5px",left:n.pageX+
"px",top:n.pageY+"px"});p.each(b.target_fields,function(f,l){if(l.iso.toUpperCase()!==v.toUpperCase()&&""!==l.field){let t=l.field,D=d.var;f=A.filter(w=>w.iso.toUpperCase()===l.iso.toUpperCase())[0].button_label;f=new Kuc.Button({text:f,type:"normal",id:t});e.append(f);p(f).on("click",async()=>{try{const w=l.iso;let G=F(m,D).type,x=H(m,d.var),L=p(n.target).closest("tr").index();e.remove();await I(G,w,v,x,D,t,L)}catch(w){return z.fire({icon:"error",title:"",html:w.message||w||"\u9805\u76ee\u30b3\u30fc\u30c9\u304c\u5b58\u5728\u3057\u307e\u305b\u3093"})}z.fire({position:"center-center",
icon:"success",text:"\u7ffb\u8a33\u5b8c\u4e86\u3057\u307e\u3057\u305f",showConfirmButton:!1,timer:1E3})})}});p("body").append(e);p(document).on("click",function(f){e.is(f.currentTarget)||0!==e.has(f.currentTarget).length||e.remove()});e.on("mouseleave",function(){e.remove()})},400);p(this).on("mouseout",function(){clearTimeout(y)})})}let u={},B={};p.each(E,function(b,a){if(a.space_element)if(u[a.space_element]){b=u[a.space_element][0];for(let g=0;g<a.target_fields.length;g++)a.target_fields[g].field&&
!b.target_fields[g].field&&(B[a.space_element][g]=""!=a.target_fields[g].field)}else{u[a.space_element]||(u[a.space_element]=[]);u[a.space_element].push(a);if(!B[a.space_element])for(B[a.space_element]=[],b=0;b<a.target_fields.length;b++)B[a.space_element].push(!1);for(b=0;b<a.target_fields.length;b++)B[a.space_element][b]=""!=a.target_fields[b].field}});p.each(u,function(b,a){let g=kintone.app.record.getSpaceElement(b);p.each(A,function(d,q){let n=A[d].button_label;!1!==B[b][d]&&q.iso.toUpperCase()!==
v.toUpperCase()&&(d=new Kuc.Button({text:n,type:"normal"}),g.append(d),p(d).on("click",async function(y){const k=E.filter(f=>f.space_element===b);let e=!0;for(let f=0;f<k.length;f++)try{const l=A.filter(x=>x.button_label===y.target.text)[0].iso;let t=k[f].target_fields.filter(x=>x.iso.toUpperCase()===v.toUpperCase())[0].field,D=k[f].target_fields.filter(x=>x.iso.toUpperCase()===l.toUpperCase())[0].field;if(!t||!D)continue;let w=F(m,t).type,G=H(m,t);await I(w,l,v,G,t,D,-1)}catch(l){return e=!1,z.fire({icon:"error",
title:"",html:l.message||l})}e&&z.fire({position:"center-center",icon:"success",text:"\u7ffb\u8a33\u5b8c\u4e86\u3057\u307e\u3057\u305f",showConfirmButton:!1,timer:1E3})}))})});async function I(b,a,g,d,q,n,y){let k=kintone.app.record.get();if(!1!==d){let e=k.record[d].value;for(let f=0;f<e.length;f++){let l=0>y?f:y;switch(r){case "from":if(q){d=await window.BoK.eAutoTrans.transText(g,e[l].value[n].value||"",a,b);try{e[l].value[q].value=d,kintone.app.record.set(k)}catch(t){throw Error(`\u30d5\u30a3\u30fc\u30eb\u30c9\u30b3\u30fc\u30c9${q}\u304c\u5b58\u5728\u3057\u307e\u305b\u3093`);
}}break;case "to":if(n){d=await window.BoK.eAutoTrans.transText(a,e[l].value[q].value||"",g,b);try{e[l].value[n].value=d,kintone.app.record.set(k)}catch(t){throw Error(`\u30d5\u30a3\u30fc\u30eb\u30c9\u30b3\u30fc\u30c9${n}\u304c\u5b58\u5728\u3057\u307e\u305b\u3093`);}}}if(-1<y)break}}else switch(r){case "from":if(q){d=await window.BoK.eAutoTrans.transText(g,k.record[n].value||"",a,b);try{k.record[q].value=d,kintone.app.record.set(k)}catch(e){throw Error(`\u30d5\u30a3\u30fc\u30eb\u30c9\u30b3\u30fc\u30c9${q}\u304c\u5b58\u5728\u3057\u307e\u305b\u3093`);
}}break;case "to":if(n){d=await window.BoK.eAutoTrans.transText(a,k.record[q].value||"",g,b);try{k.record[n].value=d,kintone.app.record.set(k)}catch(e){throw Error(`\u30d5\u30a3\u30fc\u30eb\u30c9\u30b3\u30fc\u30c9${n}\u304c\u5b58\u5728\u3057\u307e\u305b\u3093`);}}}}return c}catch(m){return z.fire({icon:"error",title:"",html:m.message||m})}})}})(jQuery,Sweetalert2_10.noConflict(!0),kintone.$PLUGIN_ID);
